<% content_for :stylesheets do %>
    <%= stylesheet_link_tag :datatables %>
<% end %>

<% content_for :javascripts do %>
    <%= javascript_include_tag :datatables, :admin_index %>
<% end %>

<div id="content-inner">
  <h1>Resetear cr&eacute;ditos</h1>
  <%= form_tag({controller: "users", action: "reset"}, method: "post") do %>
  <fieldset class="gray">

    <div class="clearfix">
      <%= label_tag :last_reset_date, 'Último reseteo' %>
      <div class="input">
        <%= text_field_tag(:last_reset_date, @last_reset_date, :readonly => true) -%>
      </div>
    </div>

    <div class="clearfix">
      <%= label_tag :mes_reset, 'Resetear hasta' %>
      <div class="input">
        <%= select_tag :month, options_for_select(Payment.months.invert, @selected_month || Chronic.parse("now").strftime('%B').downcase ), :style => "text-transform:capitalize" %>
        <%= select_tag :year, options_for_select((Time.now.year-2..Time.now.year+1).to_a, @selected_year || Time.now.year) %>
      </div>
    </div>

    <div class="clearfix">
      <%= label_tag :credit_to_reset, 'Créditos a resetear' %>
      <div class="input">
        <%= text_field_tag(:credit_to_reset, @credits_to_reset, :readonly => true) -%>
      </div>
    </div>

    <div class="actions">
      <%= button_tag("Simular", id: "search-reset", class: "btn primary", :type => 'button') -%>
      <%= button_tag("Resetear", id: "do-reset", class: "btn", :type => 'button') -%>
    </div>
  </fieldset>
  <% end %>

  <div class="clearfix">
    <% datatable "reset-credits-table", ["Cliente", "Créditos actuales", "Créditos después del reseteo"], :class => "selectable", :footer => true do -%>
    <% end -%>
  </div>

</div>

<script>
    $(document).ready(
            function() {
                var oTable = $('#reset-credits-table').resetCreditsTable();

                $('#search-reset').click(
                        function () {
                            oTable.ajax.url("/users/reset_search.json?month=" + $('#month').val() + "&year=" + $('#year').val()).load();
                        }
                );
            }
    );
</script>